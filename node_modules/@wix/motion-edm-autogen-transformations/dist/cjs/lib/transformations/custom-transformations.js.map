{"version":3,"names":["_motionEdmAutogenTransformationsCore","require","_jsonpathPlus","_lodash","getValueAtPath","json","path","JSONPath","wrap","getValueToSpread","sourceObject","expressionOfValueToSpread","spreadOperatorSiblingKeys","valueToSpread","transform","isPlainObject","pickBy","_","k","includes","resolveArgumentValues","argumentExpressions","map","expression","isJsonPathExpression","transformation","customFunctions","undefined","reduceTransformation","visitors","TopLevelSimpleTransformationExpression","TopLevelCustomFunctionExpression","functionName","runCustomFunctionCallExpression","argumentValues","transformationParentPath","NestedSpreadExpression","acc","existing","get","set","TopLevelSpreadExpression","Object","keys","forEach","key","CustomFunctionExpression","customFunctionResult","NestedSimpleTransformationExpression","simpleTransformationExpression","TopLevelMapArrayItems","sourceArrayExpression","itemTransformation","source","Array","isArray","item","MapArrayItems","transformedValue","TopLevelOmit","sourcePathExpression","fieldsToOmit","omit","NestedOmit","accumulator","value","NestedConstantValue","transformToRequestMessage","exports","transformResponseMessage"],"sources":["../../../../src/lib/transformations/custom-transformations.ts"],"sourcesContent":["import {\n  isJsonPathExpression,\n  reduceTransformation,\n  runCustomFunctionCallExpression,\n} from '@wix/motion-edm-autogen-transformations-core';\nimport { JSONPath } from 'jsonpath-plus';\nimport { get, isPlainObject, omit, pickBy, set } from 'lodash';\n\nconst getValueAtPath = (json, path) => JSONPath({ path, json, wrap: false });\n\nconst getValueToSpread = ({\n  sourceObject,\n  expressionOfValueToSpread,\n  spreadOperatorSiblingKeys,\n}) => {\n  // eslint-disable-next-line no-use-before-define\n  const valueToSpread = transform(sourceObject, expressionOfValueToSpread);\n\n  return isPlainObject(valueToSpread)\n    ? pickBy(valueToSpread, (_, k) => !spreadOperatorSiblingKeys.includes(k))\n    : {};\n};\n\nconst resolveArgumentValues = (argumentExpressions, sourceObject) =>\n  argumentExpressions.map((expression) =>\n    isJsonPathExpression(expression)\n      ? getValueAtPath(sourceObject, expression)\n      : expression,\n  );\n\nconst transform = (sourceObject, transformation, customFunctions = undefined) =>\n  reduceTransformation(transformation, {\n    visitors: {\n      TopLevelSimpleTransformationExpression: (expression) =>\n        getValueAtPath(sourceObject, expression),\n      TopLevelCustomFunctionExpression: (functionName, argumentExpressions) =>\n        runCustomFunctionCallExpression({\n          customFunctions,\n          functionName,\n          argumentValues: resolveArgumentValues(\n            argumentExpressions,\n            sourceObject,\n          ),\n          transformationParentPath: '',\n        }),\n      NestedSpreadExpression: (\n        acc,\n        path,\n        expressionOfValueToSpread,\n        spreadOperatorSiblingKeys,\n      ) => {\n        const valueToSpread = getValueToSpread({\n          sourceObject,\n          expressionOfValueToSpread,\n          spreadOperatorSiblingKeys,\n        });\n\n        const existing = get(acc, path, {});\n\n        set(acc, path, { ...existing, ...valueToSpread });\n      },\n      TopLevelSpreadExpression: (\n        acc,\n        expressionOfValueToSpread,\n        spreadOperatorSiblingKeys,\n      ) => {\n        const valueToSpread = getValueToSpread({\n          sourceObject,\n          expressionOfValueToSpread,\n          spreadOperatorSiblingKeys,\n        });\n\n        Object.keys(valueToSpread).forEach((key) => {\n          acc[key] = valueToSpread[key];\n        });\n      },\n      CustomFunctionExpression: (\n        acc,\n        path,\n        functionName,\n        argumentExpressions,\n      ) => {\n        const customFunctionResult = runCustomFunctionCallExpression({\n          customFunctions,\n          functionName,\n          argumentValues: resolveArgumentValues(\n            argumentExpressions,\n            sourceObject,\n          ),\n          transformationParentPath: path,\n        });\n\n        set(acc, path, customFunctionResult);\n      },\n      NestedSimpleTransformationExpression: (\n        acc,\n        path,\n        simpleTransformationExpression,\n      ) => {\n        set(\n          acc,\n          path,\n          getValueAtPath(sourceObject, simpleTransformationExpression),\n        );\n      },\n      TopLevelMapArrayItems: (sourceArrayExpression, itemTransformation) => {\n        const source = transform(sourceObject, sourceArrayExpression);\n\n        return Array.isArray(source)\n          ? source.map((item) =>\n              transform(item, itemTransformation, customFunctions),\n            )\n          : source;\n      },\n      MapArrayItems: (acc, path, sourceArrayExpression, itemTransformation) => {\n        const source = transform(sourceObject, sourceArrayExpression);\n\n        const transformedValue = Array.isArray(source)\n          ? source.map((item) =>\n              transform(item, itemTransformation, customFunctions),\n            )\n          : source;\n\n        set(acc, path, transformedValue);\n      },\n      TopLevelOmit: (sourcePathExpression, fieldsToOmit) => {\n        const source = transform(sourceObject, sourcePathExpression);\n\n        if (source === undefined) {\n          return undefined;\n        }\n\n        return isPlainObject(source)\n          ? omit(source, fieldsToOmit)\n          : sourceObject;\n      },\n\n      NestedOmit: (accumulator, path, sourcePathExpression, fieldsToOmit) => {\n        const source = transform(sourceObject, sourcePathExpression);\n\n        if (source === undefined) {\n          set(accumulator, path, undefined);\n\n          return;\n        }\n\n        const value = isPlainObject(source)\n          ? omit(source, fieldsToOmit)\n          : source;\n\n        set(accumulator, path, value);\n      },\n      NestedConstantValue: ({ accumulator, path, value }) => {\n        set(accumulator, path, value);\n      },\n    },\n    accumulator: {},\n  });\n\nconst transformToRequestMessage = (\n  sourceObject,\n  transformation,\n  customFunctions: any = undefined,\n) => transform(sourceObject, transformation, customFunctions) || {};\n\nconst transformResponseMessage = (\n  sourceObject,\n  transformation,\n  customFunctions: any = undefined,\n) => transform(sourceObject, transformation, customFunctions);\n\nexport { transformResponseMessage, transformToRequestMessage };\n"],"mappings":";;;;AAAA,IAAAA,oCAAA,GAAAC,OAAA;AAKA,IAAAC,aAAA,GAAAD,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AAEA,MAAMG,cAAc,GAAGA,CAACC,IAAI,EAAEC,IAAI,KAAK,IAAAC,sBAAQ,EAAC;EAAED,IAAI;EAAED,IAAI;EAAEG,IAAI,EAAE;AAAM,CAAC,CAAC;AAE5E,MAAMC,gBAAgB,GAAGA,CAAC;EACxBC,YAAY;EACZC,yBAAyB;EACzBC;AACF,CAAC,KAAK;EACJ;EACA,MAAMC,aAAa,GAAGC,SAAS,CAACJ,YAAY,EAAEC,yBAAyB,CAAC;EAExE,OAAO,IAAAI,qBAAa,EAACF,aAAa,CAAC,GAC/B,IAAAG,cAAM,EAACH,aAAa,EAAE,CAACI,CAAC,EAAEC,CAAC,KAAK,CAACN,yBAAyB,CAACO,QAAQ,CAACD,CAAC,CAAC,CAAC,GACvE,CAAC,CAAC;AACR,CAAC;AAED,MAAME,qBAAqB,GAAGA,CAACC,mBAAmB,EAAEX,YAAY,KAC9DW,mBAAmB,CAACC,GAAG,CAAEC,UAAU,IACjC,IAAAC,yDAAoB,EAACD,UAAU,CAAC,GAC5BnB,cAAc,CAACM,YAAY,EAAEa,UAAU,CAAC,GACxCA,UACN,CAAC;AAEH,MAAMT,SAAS,GAAGA,CAACJ,YAAY,EAAEe,cAAc,EAAEC,eAAe,GAAGC,SAAS,KAC1E,IAAAC,yDAAoB,EAACH,cAAc,EAAE;EACnCI,QAAQ,EAAE;IACRC,sCAAsC,EAAGP,UAAU,IACjDnB,cAAc,CAACM,YAAY,EAAEa,UAAU,CAAC;IAC1CQ,gCAAgC,EAAEA,CAACC,YAAY,EAAEX,mBAAmB,KAClE,IAAAY,oEAA+B,EAAC;MAC9BP,eAAe;MACfM,YAAY;MACZE,cAAc,EAAEd,qBAAqB,CACnCC,mBAAmB,EACnBX,YACF,CAAC;MACDyB,wBAAwB,EAAE;IAC5B,CAAC,CAAC;IACJC,sBAAsB,EAAEA,CACtBC,GAAG,EACH/B,IAAI,EACJK,yBAAyB,EACzBC,yBAAyB,KACtB;MACH,MAAMC,aAAa,GAAGJ,gBAAgB,CAAC;QACrCC,YAAY;QACZC,yBAAyB;QACzBC;MACF,CAAC,CAAC;MAEF,MAAM0B,QAAQ,GAAG,IAAAC,WAAG,EAACF,GAAG,EAAE/B,IAAI,EAAE,CAAC,CAAC,CAAC;MAEnC,IAAAkC,WAAG,EAACH,GAAG,EAAE/B,IAAI,EAAE;QAAE,GAAGgC,QAAQ;QAAE,GAAGzB;MAAc,CAAC,CAAC;IACnD,CAAC;IACD4B,wBAAwB,EAAEA,CACxBJ,GAAG,EACH1B,yBAAyB,EACzBC,yBAAyB,KACtB;MACH,MAAMC,aAAa,GAAGJ,gBAAgB,CAAC;QACrCC,YAAY;QACZC,yBAAyB;QACzBC;MACF,CAAC,CAAC;MAEF8B,MAAM,CAACC,IAAI,CAAC9B,aAAa,CAAC,CAAC+B,OAAO,CAAEC,GAAG,IAAK;QAC1CR,GAAG,CAACQ,GAAG,CAAC,GAAGhC,aAAa,CAACgC,GAAG,CAAC;MAC/B,CAAC,CAAC;IACJ,CAAC;IACDC,wBAAwB,EAAEA,CACxBT,GAAG,EACH/B,IAAI,EACJ0B,YAAY,EACZX,mBAAmB,KAChB;MACH,MAAM0B,oBAAoB,GAAG,IAAAd,oEAA+B,EAAC;QAC3DP,eAAe;QACfM,YAAY;QACZE,cAAc,EAAEd,qBAAqB,CACnCC,mBAAmB,EACnBX,YACF,CAAC;QACDyB,wBAAwB,EAAE7B;MAC5B,CAAC,CAAC;MAEF,IAAAkC,WAAG,EAACH,GAAG,EAAE/B,IAAI,EAAEyC,oBAAoB,CAAC;IACtC,CAAC;IACDC,oCAAoC,EAAEA,CACpCX,GAAG,EACH/B,IAAI,EACJ2C,8BAA8B,KAC3B;MACH,IAAAT,WAAG,EACDH,GAAG,EACH/B,IAAI,EACJF,cAAc,CAACM,YAAY,EAAEuC,8BAA8B,CAC7D,CAAC;IACH,CAAC;IACDC,qBAAqB,EAAEA,CAACC,qBAAqB,EAAEC,kBAAkB,KAAK;MACpE,MAAMC,MAAM,GAAGvC,SAAS,CAACJ,YAAY,EAAEyC,qBAAqB,CAAC;MAE7D,OAAOG,KAAK,CAACC,OAAO,CAACF,MAAM,CAAC,GACxBA,MAAM,CAAC/B,GAAG,CAAEkC,IAAI,IACd1C,SAAS,CAAC0C,IAAI,EAAEJ,kBAAkB,EAAE1B,eAAe,CACrD,CAAC,GACD2B,MAAM;IACZ,CAAC;IACDI,aAAa,EAAEA,CAACpB,GAAG,EAAE/B,IAAI,EAAE6C,qBAAqB,EAAEC,kBAAkB,KAAK;MACvE,MAAMC,MAAM,GAAGvC,SAAS,CAACJ,YAAY,EAAEyC,qBAAqB,CAAC;MAE7D,MAAMO,gBAAgB,GAAGJ,KAAK,CAACC,OAAO,CAACF,MAAM,CAAC,GAC1CA,MAAM,CAAC/B,GAAG,CAAEkC,IAAI,IACd1C,SAAS,CAAC0C,IAAI,EAAEJ,kBAAkB,EAAE1B,eAAe,CACrD,CAAC,GACD2B,MAAM;MAEV,IAAAb,WAAG,EAACH,GAAG,EAAE/B,IAAI,EAAEoD,gBAAgB,CAAC;IAClC,CAAC;IACDC,YAAY,EAAEA,CAACC,oBAAoB,EAAEC,YAAY,KAAK;MACpD,MAAMR,MAAM,GAAGvC,SAAS,CAACJ,YAAY,EAAEkD,oBAAoB,CAAC;MAE5D,IAAIP,MAAM,KAAK1B,SAAS,EAAE;QACxB,OAAOA,SAAS;MAClB;MAEA,OAAO,IAAAZ,qBAAa,EAACsC,MAAM,CAAC,GACxB,IAAAS,YAAI,EAACT,MAAM,EAAEQ,YAAY,CAAC,GAC1BnD,YAAY;IAClB,CAAC;IAEDqD,UAAU,EAAEA,CAACC,WAAW,EAAE1D,IAAI,EAAEsD,oBAAoB,EAAEC,YAAY,KAAK;MACrE,MAAMR,MAAM,GAAGvC,SAAS,CAACJ,YAAY,EAAEkD,oBAAoB,CAAC;MAE5D,IAAIP,MAAM,KAAK1B,SAAS,EAAE;QACxB,IAAAa,WAAG,EAACwB,WAAW,EAAE1D,IAAI,EAAEqB,SAAS,CAAC;QAEjC;MACF;MAEA,MAAMsC,KAAK,GAAG,IAAAlD,qBAAa,EAACsC,MAAM,CAAC,GAC/B,IAAAS,YAAI,EAACT,MAAM,EAAEQ,YAAY,CAAC,GAC1BR,MAAM;MAEV,IAAAb,WAAG,EAACwB,WAAW,EAAE1D,IAAI,EAAE2D,KAAK,CAAC;IAC/B,CAAC;IACDC,mBAAmB,EAAEA,CAAC;MAAEF,WAAW;MAAE1D,IAAI;MAAE2D;IAAM,CAAC,KAAK;MACrD,IAAAzB,WAAG,EAACwB,WAAW,EAAE1D,IAAI,EAAE2D,KAAK,CAAC;IAC/B;EACF,CAAC;EACDD,WAAW,EAAE,CAAC;AAChB,CAAC,CAAC;AAEJ,MAAMG,yBAAyB,GAAGA,CAChCzD,YAAY,EACZe,cAAc,EACdC,eAAoB,GAAGC,SAAS,KAC7Bb,SAAS,CAACJ,YAAY,EAAEe,cAAc,EAAEC,eAAe,CAAC,IAAI,CAAC,CAAC;AAAC0C,OAAA,CAAAD,yBAAA,GAAAA,yBAAA;AAEpE,MAAME,wBAAwB,GAAGA,CAC/B3D,YAAY,EACZe,cAAc,EACdC,eAAoB,GAAGC,SAAS,KAC7Bb,SAAS,CAACJ,YAAY,EAAEe,cAAc,EAAEC,eAAe,CAAC;AAAC0C,OAAA,CAAAC,wBAAA,GAAAA,wBAAA"}