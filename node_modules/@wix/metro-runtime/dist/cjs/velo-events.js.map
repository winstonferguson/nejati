{"version":3,"names":["_lodash","require","_veloIndex","exports","RootPath","toVeloEvent","domainEvent","serializerParams","veloEvent","metadata","toMetadata","deletedEvent","_toVeloPayload","toVeloPayload","key","payload","protoPayload","extractDomainEventPayload","serializer","fromJSON","actionEvent","pick"],"sources":["../../src/velo-events.ts"],"sourcesContent":["import { pick } from 'lodash';\nimport { SerializerParams } from './types';\nimport {\n  DomainEvent,\n  DomainEventMetadata,\n  extractDomainEventPayload,\n  serializer,\n  RootPath,\n} from './velo-index';\n\nexport { RootPath };\n\nexport function toVeloEvent(\n  domainEvent: DomainEvent,\n  serializerParams: SerializerParams,\n): VeloEvent {\n  const veloEvent: VeloEvent = { metadata: toMetadata(domainEvent) };\n\n  if (!domainEvent.deletedEvent) {\n    const { key, payload } = toVeloPayload(domainEvent, serializerParams);\n\n    veloEvent[key] = payload;\n  }\n\n  return veloEvent;\n}\n\nfunction toVeloPayload(\n  domainEvent: DomainEvent,\n  serializerParams: SerializerParams,\n) {\n  const protoPayload = extractDomainEventPayload(domainEvent);\n  const payload = serializer(serializerParams).fromJSON(protoPayload);\n  const key: keyof VeloEvent = domainEvent.actionEvent ? 'data' : 'entity';\n\n  return { key, payload };\n}\n\nfunction toMetadata(domainEvent: DomainEvent) {\n  return pick(\n    domainEvent,\n    'id',\n    'entityId',\n    'eventTime',\n    'triggeredByAnonymizeRequest',\n  );\n}\n\ntype VeloEvent = {\n  metadata: DomainEventMetadata;\n  data?: any;\n  entity?: any;\n};\n"],"mappings":";;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AAEA,IAAAC,UAAA,GAAAD,OAAA;AAMsBE,OAAA,CAAAC,QAAA,GAAAF,UAAA,CAAAE,QAAA;AAIf,SAASC,WAAWA,CACzBC,WAAwB,EACxBC,gBAAkC,EACvB;EACX,MAAMC,SAAoB,GAAG;IAAEC,QAAQ,EAAEC,UAAU,CAACJ,WAAW;EAAE,CAAC;EAElE,IAAI,CAACA,WAAW,CAACK,YAAY,EAAE;IAC7B,MAAAC,cAAA,GAAyBC,aAAa,CAACP,WAAW,EAAEC,gBAAgB,CAAC;MAA7DO,GAAG,GAAAF,cAAA,CAAHE,GAAG;MAAEC,OAAO,GAAAH,cAAA,CAAPG,OAAO;IAEpBP,SAAS,CAACM,GAAG,CAAC,GAAGC,OAAO;EAC1B;EAEA,OAAOP,SAAS;AAClB;AAEA,SAASK,aAAaA,CACpBP,WAAwB,EACxBC,gBAAkC,EAClC;EACA,MAAMS,YAAY,GAAG,IAAAC,oCAAyB,EAACX,WAAW,CAAC;EAC3D,MAAMS,OAAO,GAAG,IAAAG,qBAAU,EAACX,gBAAgB,CAAC,CAACY,QAAQ,CAACH,YAAY,CAAC;EACnE,MAAMF,GAAoB,GAAGR,WAAW,CAACc,WAAW,GAAG,MAAM,GAAG,QAAQ;EAExE,OAAO;IAAEN,GAAG;IAAEC;EAAQ,CAAC;AACzB;AAEA,SAASL,UAAUA,CAACJ,WAAwB,EAAE;EAC5C,OAAO,IAAAe,YAAI,EACTf,WAAW,EACX,IAAI,EACJ,UAAU,EACV,WAAW,EACX,6BACF,CAAC;AACH"}