{"version":3,"names":["_domain","require","fieldMask","types","ConverterType","TO_JSON","transform","val","join","checkRepetable","some","v","Array","isArray","FROM_JSON","paths","split","exports"],"sources":["../../../../src/serializer/protobuf-converters/field-mask.ts"],"sourcesContent":["import { ConverterSet, ConverterType } from '../domain';\n\nexport const fieldMask: ConverterSet = {\n  types: ['google.protobuf.FieldMask'],\n\n  [ConverterType.TO_JSON]: {\n    transform: (val: string[]) => val.join(','),\n\n    /**\n     * This one handles cases where we have a repeated google.protobuf.FieldMask type,\n     * so it will look like: [['foo', 'bar'], ['qux']].\n     *\n     * The problem is that the serializer detects it as an array with actual fields (strings),\n     * while in practice it is an array of multiple google.protobuf.FieldMask.\n     *\n     * We should determine if the items are actual fields (so each item is a string),\n     * or arrays of google.protobuf.FieldMask (so each item is array that has items with fields).\n     *\n     * Another approach could be marking on the schama itseld each field if it's a repeatable or not,\n     * it's not a good appraoch, but as long as google.protobuf.FieldMask is our only issue, it's\n     * not _that_ bad solution.\n     */\n    checkRepetable: (val: string[] | string[][]) => {\n      return val.some((v: string | string[]) => Array.isArray(v));\n    },\n  },\n\n  [ConverterType.FROM_JSON]: {\n    transform: (val: string | { paths: string[] }) => {\n      /**\n       * Support Scala FW JSON mapping bug, for more details see:\n       *\n       * https://github.com/wix-private/server-infra/issues/17953\n       */\n      if (typeof val === 'object') {\n        return val.paths;\n      }\n\n      return val.split(',');\n    },\n  },\n};\n"],"mappings":";;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AAEO,MAAMC,SAAuB,GAAG;EACrCC,KAAK,EAAE,CAAC,2BAA2B,CAAC;EAEpC,CAACC,qBAAa,CAACC,OAAO,GAAG;IACvBC,SAAS,EAAGC,GAAa,IAAKA,GAAG,CAACC,IAAI,CAAC,GAAG,CAAC;IAE3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIC,cAAc,EAAGF,GAA0B,IAAK;MAC9C,OAAOA,GAAG,CAACG,IAAI,CAAEC,CAAoB,IAAKC,KAAK,CAACC,OAAO,CAACF,CAAC,CAAC,CAAC;IAC7D;EACF,CAAC;EAED,CAACP,qBAAa,CAACU,SAAS,GAAG;IACzBR,SAAS,EAAGC,GAAiC,IAAK;MAChD;AACN;AACA;AACA;AACA;MACM,IAAI,OAAOA,GAAG,KAAK,QAAQ,EAAE;QAC3B,OAAOA,GAAG,CAACQ,KAAK;MAClB;MAEA,OAAOR,GAAG,CAACS,KAAK,CAAC,GAAG,CAAC;IACvB;EACF;AACF,CAAC;AAACC,OAAA,CAAAf,SAAA,GAAAA,SAAA"}