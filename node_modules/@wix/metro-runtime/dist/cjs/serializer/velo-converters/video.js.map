{"version":3,"names":["_querystring","_interopRequireDefault","require","_domain","_convertersUtils","WIX_VIDEO","video","types","ConverterType","FROM_JSON","transform","val","_val$thumbnail","posterData","thumbnail","id","URL_HASH_PREFIX","width","height","url","TO_JSON","alignedVideo","alignIfLegacy","_URL","URL","protocol","hash","pathname","_querystring$parse","querystring","parse","replace","posterHeight","posterWidth","posterUri","_pathname$replace$spl","split","WIX_PROTOCOL","Number","toString","exports"],"sources":["../../../../src/serializer/velo-converters/video.ts"],"sourcesContent":["import querystring from 'querystring';\nimport type com from '../../proto';\nimport { ConverterSet, ConverterType } from '../domain';\nimport {\n  alignIfLegacy,\n  URL_HASH_PREFIX,\n  WIX_PROTOCOL,\n} from './converters-utils';\n\nconst WIX_VIDEO = 'video';\n\nexport const video: ConverterSet = {\n  types: ['wix.common.Video'],\n\n  [ConverterType.FROM_JSON]: {\n    transform: (val: com.wix.common.Video) => {\n      if (!val) {\n        return;\n      }\n\n      let posterData = '';\n      if (val.thumbnail?.id) {\n        posterData = `${URL_HASH_PREFIX}posterUri=${val.thumbnail.id}&posterWidth=${val.thumbnail.width}&posterHeight=${val.thumbnail.height}`;\n      }\n\n      return val.id ? `wix:video://v1/${val.id}${posterData}` : val.url;\n    },\n  },\n\n  [ConverterType.TO_JSON]: {\n    transform: (val: string): com.wix.common.Video | undefined => {\n      if (!val) {\n        return;\n      }\n\n      const alignedVideo = alignIfLegacy(val, WIX_VIDEO);\n\n      const { protocol, hash, pathname } = new URL(alignedVideo);\n      const {\n        posterHeight: height,\n        posterWidth: width,\n        posterUri,\n      } = querystring.parse(hash.replace(URL_HASH_PREFIX, ''));\n      const [id] = pathname.replace(`${WIX_VIDEO}://v1/`, '').split('/');\n\n      if (protocol === WIX_PROTOCOL) {\n        if (!posterUri) {\n          return { id };\n        }\n        return {\n          id,\n          thumbnail: {\n            height: Number(height),\n            width: Number(width),\n            id: posterUri.toString(),\n          },\n        };\n      }\n      return { url: val };\n    },\n  },\n};\n"],"mappings":";;;;;AAAA,IAAAA,YAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,OAAA,GAAAD,OAAA;AACA,IAAAE,gBAAA,GAAAF,OAAA;AAMA,MAAMG,SAAS,GAAG,OAAO;AAElB,MAAMC,KAAmB,GAAG;EACjCC,KAAK,EAAE,CAAC,kBAAkB,CAAC;EAE3B,CAACC,qBAAa,CAACC,SAAS,GAAG;IACzBC,SAAS,EAAGC,GAAyB,IAAK;MAAA,IAAAC,cAAA;MACxC,IAAI,CAACD,GAAG,EAAE;QACR;MACF;MAEA,IAAIE,UAAU,GAAG,EAAE;MACnB,KAAAD,cAAA,GAAID,GAAG,CAACG,SAAS,aAAbF,cAAA,CAAeG,EAAE,EAAE;QACrBF,UAAU,GAAI,GAAEG,gCAAgB,aAAYL,GAAG,CAACG,SAAS,CAACC,EAAG,gBAAeJ,GAAG,CAACG,SAAS,CAACG,KAAM,iBAAgBN,GAAG,CAACG,SAAS,CAACI,MAAO,EAAC;MACxI;MAEA,OAAOP,GAAG,CAACI,EAAE,GAAI,kBAAiBJ,GAAG,CAACI,EAAG,GAAEF,UAAW,EAAC,GAAGF,GAAG,CAACQ,GAAG;IACnE;EACF,CAAC;EAED,CAACX,qBAAa,CAACY,OAAO,GAAG;IACvBV,SAAS,EAAGC,GAAW,IAAuC;MAC5D,IAAI,CAACA,GAAG,EAAE;QACR;MACF;MAEA,MAAMU,YAAY,GAAG,IAAAC,8BAAa,EAACX,GAAG,EAAEN,SAAS,CAAC;MAElD,MAAAkB,IAAA,GAAqC,IAAIC,GAAG,CAACH,YAAY,CAAC;QAAlDI,QAAQ,GAAAF,IAAA,CAARE,QAAQ;QAAEC,IAAI,GAAAH,IAAA,CAAJG,IAAI;QAAEC,QAAQ,GAAAJ,IAAA,CAARI,QAAQ;MAChC,MAAAC,kBAAA,GAIIC,oBAAW,CAACC,KAAK,CAACJ,IAAI,CAACK,OAAO,CAACf,gCAAe,EAAE,EAAE,CAAC,CAAC;QAHxCE,MAAM,GAAAU,kBAAA,CAApBI,YAAY;QACCf,KAAK,GAAAW,kBAAA,CAAlBK,WAAW;QACXC,SAAS,GAAAN,kBAAA,CAATM,SAAS;MAEX,MAAAC,qBAAA,GAAaR,QAAQ,CAACI,OAAO,CAAE,GAAE1B,SAAU,QAAO,EAAE,EAAE,CAAC,CAAC+B,KAAK,CAAC,GAAG,CAAC;QAA3DrB,EAAE,GAAAoB,qBAAA;MAET,IAAIV,QAAQ,KAAKY,6BAAY,EAAE;QAC7B,IAAI,CAACH,SAAS,EAAE;UACd,OAAO;YAAEnB;UAAG,CAAC;QACf;QACA,OAAO;UACLA,EAAE;UACFD,SAAS,EAAE;YACTI,MAAM,EAAEoB,MAAM,CAACpB,MAAM,CAAC;YACtBD,KAAK,EAAEqB,MAAM,CAACrB,KAAK,CAAC;YACpBF,EAAE,EAAEmB,SAAS,CAACK,QAAQ,CAAC;UACzB;QACF,CAAC;MACH;MACA,OAAO;QAAEpB,GAAG,EAAER;MAAI,CAAC;IACrB;EACF;AACF,CAAC;AAAC6B,OAAA,CAAAlC,KAAA,GAAAA,KAAA"}