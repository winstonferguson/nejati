{"version":3,"names":["_domain","require","_convertersUtils","createMediaConverter","fieldType","commonType","types","ConverterType","FROM_JSON","transform","val","fileName","filename","encodeText","id","url","TO_JSON","alignedUrl","alignIfLegacy","_URL","URL","protocol","pathname","_pathname$replace$spl","replace","split","WIX_PROTOCOL","decodeText"],"sources":["../../../../src/serializer/velo-converters/base-media.ts"],"sourcesContent":["import { ConverterSet, ConverterType } from '../domain';\nimport {\n  alignIfLegacy,\n  decodeText,\n  encodeText,\n  WIX_PROTOCOL,\n} from './converters-utils';\n\nexport function createMediaConverter<\n  T extends {\n    id?: string | null;\n    url?: string | null;\n    filename?: string | null;\n  },\n>(fieldType: string, commonType: string): ConverterSet {\n  return {\n    types: [commonType],\n\n    [ConverterType.FROM_JSON]: {\n      transform: (val: T) => {\n        if (!val) {\n          return;\n        }\n\n        let fileName = '';\n        if (val?.filename) {\n          fileName = `/${encodeText(val.filename)}`;\n        }\n\n        return val.id ? `wix:${fieldType}://v1/${val.id}${fileName}` : val.url;\n      },\n    },\n\n    [ConverterType.TO_JSON]: {\n      transform: (val: string): T | undefined => {\n        if (!val) {\n          return;\n        }\n\n        const alignedUrl = alignIfLegacy(val, fieldType);\n\n        const { protocol, pathname } = new URL(alignedUrl);\n\n        const [id, filename] = pathname\n          .replace(`${fieldType}://v1/`, '')\n          .split('/');\n\n        if (protocol === WIX_PROTOCOL) {\n          if (!filename) {\n            return { id } as T;\n          }\n\n          return {\n            id,\n            filename: decodeText(filename),\n          } as T;\n        }\n\n        return { url: val } as T;\n      },\n    },\n  };\n}\n"],"mappings":";;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,gBAAA,GAAAD,OAAA;AAOO,SAASE,oBAAoBA,CAMlCC,SAAiB,EAAEC,UAAkB,EAAgB;EACrD,OAAO;IACLC,KAAK,EAAE,CAACD,UAAU,CAAC;IAEnB,CAACE,qBAAa,CAACC,SAAS,GAAG;MACzBC,SAAS,EAAGC,GAAM,IAAK;QACrB,IAAI,CAACA,GAAG,EAAE;UACR;QACF;QAEA,IAAIC,QAAQ,GAAG,EAAE;QACjB,IAAID,GAAG,YAAHA,GAAG,CAAEE,QAAQ,EAAE;UACjBD,QAAQ,GAAI,IAAG,IAAAE,2BAAU,EAACH,GAAG,CAACE,QAAQ,CAAE,EAAC;QAC3C;QAEA,OAAOF,GAAG,CAACI,EAAE,GAAI,OAAMV,SAAU,SAAQM,GAAG,CAACI,EAAG,GAAEH,QAAS,EAAC,GAAGD,GAAG,CAACK,GAAG;MACxE;IACF,CAAC;IAED,CAACR,qBAAa,CAACS,OAAO,GAAG;MACvBP,SAAS,EAAGC,GAAW,IAAoB;QACzC,IAAI,CAACA,GAAG,EAAE;UACR;QACF;QAEA,MAAMO,UAAU,GAAG,IAAAC,8BAAa,EAACR,GAAG,EAAEN,SAAS,CAAC;QAEhD,MAAAe,IAAA,GAA+B,IAAIC,GAAG,CAACH,UAAU,CAAC;UAA1CI,QAAQ,GAAAF,IAAA,CAARE,QAAQ;UAAEC,QAAQ,GAAAH,IAAA,CAARG,QAAQ;QAE1B,MAAAC,qBAAA,GAAuBD,QAAQ,CAC5BE,OAAO,CAAE,GAAEpB,SAAU,QAAO,EAAE,EAAE,CAAC,CACjCqB,KAAK,CAAC,GAAG,CAAC;UAFNX,EAAE,GAAAS,qBAAA;UAAEX,QAAQ,GAAAW,qBAAA;QAInB,IAAIF,QAAQ,KAAKK,6BAAY,EAAE;UAC7B,IAAI,CAACd,QAAQ,EAAE;YACb,OAAO;cAAEE;YAAG,CAAC;UACf;UAEA,OAAO;YACLA,EAAE;YACFF,QAAQ,EAAE,IAAAe,2BAAU,EAACf,QAAQ;UAC/B,CAAC;QACH;QAEA,OAAO;UAAEG,GAAG,EAAEL;QAAI,CAAC;MACrB;IACF;EACF,CAAC;AACH"}