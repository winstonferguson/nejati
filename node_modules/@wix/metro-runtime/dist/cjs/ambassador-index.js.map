{"version":3,"names":["_domain","require","_serializer","_converters","_utils","ambassadorConverters","typeToConverterSet","protobufConverters","serializer","rootSchema","depSchemas","transform","schemaSerializer","fromJSON","jsonOrString","jsonOrText","safeJsonParse","ConverterType","FROM_JSON","toJSON","json","TO_JSON","someString","JSON","parse","error"],"sources":["../../src/ambassador-index.ts"],"sourcesContent":["import type {\n  RenderedLeanSchema,\n  RenderedLeanSchemaFields,\n} from '@wix/metro-public-utils';\nimport { ConverterType, Payload } from './serializer/domain';\nimport { schemaSerializer } from './serializer/serializer';\nimport { protobufConverters } from './serializer/protobuf-converters/converters';\nimport { typeToConverterSet } from './serializer/utils';\n\nconst ambassadorConverters = typeToConverterSet([...protobufConverters]);\n\nexport type {\n  Long,\n  GoogleProtoDuration,\n} from './serializer/protobuf-converters/types';\n\nexport function serializer<T>(\n  rootSchema: RenderedLeanSchemaFields,\n  depSchemas: RenderedLeanSchema = {},\n) {\n  const transform = schemaSerializer(\n    rootSchema,\n    depSchemas,\n    ambassadorConverters,\n  );\n\n  return {\n    fromJSON(jsonOrString: Payload | string): T {\n      const jsonOrText = safeJsonParse(jsonOrString) || jsonOrString;\n      return transform(jsonOrText, ConverterType.FROM_JSON) as T;\n    },\n\n    toJSON(json: T) {\n      return transform(json, ConverterType.TO_JSON) as Payload;\n    },\n  };\n}\n\nfunction safeJsonParse(someString: string): any {\n  try {\n    return JSON.parse(someString);\n  } catch (error) {}\n}\n"],"mappings":";;;;AAIA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,MAAA,GAAAH,OAAA;AAEA,MAAMI,oBAAoB,GAAG,IAAAC,yBAAkB,EAAC,CAAC,GAAGC,8BAAkB,CAAC,CAAC;AAOjE,SAASC,UAAUA,CACxBC,UAAoC,EACpCC,UAA8B,GAAG,CAAC,CAAC,EACnC;EACA,MAAMC,SAAS,GAAG,IAAAC,4BAAgB,EAChCH,UAAU,EACVC,UAAU,EACVL,oBACF,CAAC;EAED,OAAO;IACLQ,QAAQA,CAACC,YAA8B,EAAK;MAC1C,MAAMC,UAAU,GAAGC,aAAa,CAACF,YAAY,CAAC,IAAIA,YAAY;MAC9D,OAAOH,SAAS,CAACI,UAAU,EAAEE,qBAAa,CAACC,SAAS,CAAC;IACvD,CAAC;IAEDC,MAAMA,CAACC,IAAO,EAAE;MACd,OAAOT,SAAS,CAACS,IAAI,EAAEH,qBAAa,CAACI,OAAO,CAAC;IAC/C;EACF,CAAC;AACH;AAEA,SAASL,aAAaA,CAACM,UAAkB,EAAO;EAC9C,IAAI;IACF,OAAOC,IAAI,CAACC,KAAK,CAACF,UAAU,CAAC;EAC/B,CAAC,CAAC,OAAOG,KAAK,EAAE,CAAC;AACnB"}