import { ConverterSet, ConverterType } from '../domain';

export const timestamp: ConverterSet = {
  types: ['google.protobuf.Timestamp'],

  [ConverterType.TO_JSON]: {
    transform: (val: string | DbDriverDate) => {
      const date = typeof val === 'string' ? val : val?.$date;
      return new Date(date);
    },
  },

  [ConverterType.FROM_JSON]: {
    transform: (val: Date) => ({ $date: val.toISOString() }),
  },
};

interface DbDriverDate {
  $date: string;
}
