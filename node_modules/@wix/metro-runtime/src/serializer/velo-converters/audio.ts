import type com from '../../proto';
import { ConverterSet, ConverterType } from '../domain';
import { createMediaConverter } from './base-media';

const WIX_AUDIO = 'audio';
const WIX_AUDIO_COMMON_TYPE = 'wix.common.Audio';

const baseMediaConverter = createMediaConverter<com.wix.common.Audio>(
  WIX_AUDIO,
  WIX_AUDIO_COMMON_TYPE,
);

export const audio: ConverterSet = {
  types: [WIX_AUDIO_COMMON_TYPE],

  [ConverterType.FROM_JSON]: {
    transform: (val: com.wix.common.Audio) => {
      const duration = val?.duration ?? 0;
      const url = baseMediaConverter[ConverterType.FROM_JSON].transform(val);
      return `${url}${val?.id ? `#duration=${duration}` : ''}`;
    },
  },

  [ConverterType.TO_JSON]: {
    transform: (val: string): com.wix.common.Audio | undefined => {
      return baseMediaConverter[ConverterType.TO_JSON].transform(val);
    },
  },
};
