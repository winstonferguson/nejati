import type com from '../../proto';
import { ConverterSet, ConverterType } from '../domain';

export const pageUrlV2: ConverterSet = {
  types: ['wix.common.PageUrlV2'],

  [ConverterType.FROM_JSON]: {
    transform: (val: com.wix.common.PageUrlV2) => {
      if (!val) {
        return;
      }

      return val.url;
    },
  },

  [ConverterType.TO_JSON]: {
    transform: (val: string): com.wix.common.PageUrlV2 | undefined => {
      if (!val) {
        return;
      }

      const { pathname } = new URL(val);

      return {
        relativePath: pathname, // (e.g /product-page/a-product)
        url: val, // (e.g https://mysite.com/product-page/a-product)
      };
    },
  },
};
