(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define("platformized-filter-builder", [], factory);
	else if(typeof exports === 'object')
		exports["platformized-filter-builder"] = factory();
	else
		root["platformized-filter-builder"] = factory();
})((typeof self !== 'undefined' ? self : this), function() {
return /******/ (function() { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ 50:
/*!****************************************************************************************************************!*\
  !*** ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/assertThisInitialized.js ***!
  \****************************************************************************************************************/
/***/ (function(module) {

function _assertThisInitialized(self) {
  if (self === void 0) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return self;
}

module.exports = _assertThisInitialized;
module.exports["default"] = module.exports, module.exports.__esModule = true;

/***/ }),

/***/ 523:
/*!******************************************************************************************************!*\
  !*** ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/createClass.js ***!
  \******************************************************************************************************/
/***/ (function(module) {

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  return Constructor;
}

module.exports = _createClass;
module.exports["default"] = module.exports, module.exports.__esModule = true;

/***/ }),

/***/ 695:
/*!*********************************************************************************************************!*\
  !*** ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/defineProperty.js ***!
  \*********************************************************************************************************/
/***/ (function(module) {

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

module.exports = _defineProperty;
module.exports["default"] = module.exports, module.exports.__esModule = true;

/***/ }),

/***/ 710:
/*!**************************************************************************************************!*\
  !*** ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/extends.js ***!
  \**************************************************************************************************/
/***/ (function(module) {

function _extends() {
  module.exports = _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  module.exports["default"] = module.exports, module.exports.__esModule = true;
  return _extends.apply(this, arguments);
}

module.exports = _extends;
module.exports["default"] = module.exports, module.exports.__esModule = true;

/***/ }),

/***/ 333:
/*!********************************************************************************************************!*\
  !*** ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/inheritsLoose.js ***!
  \********************************************************************************************************/
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {

var setPrototypeOf = __webpack_require__(/*! ./setPrototypeOf.js */ 814);

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;
  setPrototypeOf(subClass, superClass);
}

module.exports = _inheritsLoose;
module.exports["default"] = module.exports, module.exports.__esModule = true;

/***/ }),

/***/ 814:
/*!*********************************************************************************************************!*\
  !*** ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/setPrototypeOf.js ***!
  \*********************************************************************************************************/
/***/ (function(module) {

function _setPrototypeOf(o, p) {
  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  module.exports["default"] = module.exports, module.exports.__esModule = true;
  return _setPrototypeOf(o, p);
}

module.exports = _setPrototypeOf;
module.exports["default"] = module.exports, module.exports.__esModule = true;

/***/ }),

/***/ 347:
/*!**********************!*\
  !*** ./validator.ts ***!
  \**********************/
/***/ (function() {



/***/ }),

/***/ 366:
/*!*******************************************!*\
  !*** ../../node_modules/kind-of/index.js ***!
  \*******************************************/
/***/ (function(module) {

var toString = Object.prototype.toString;

/**
 * Get the native `typeof` a value.
 *
 * @param  {*} `val`
 * @return {*} Native javascript type
 */

module.exports = function kindOf(val) {
  var type = typeof val;

  // primitivies
  if (type === 'undefined') {
    return 'undefined';
  }
  if (val === null) {
    return 'null';
  }
  if (val === true || val === false || val instanceof Boolean) {
    return 'boolean';
  }
  if (type === 'string' || val instanceof String) {
    return 'string';
  }
  if (type === 'number' || val instanceof Number) {
    return 'number';
  }

  // functions
  if (type === 'function' || val instanceof Function) {
    if (typeof val.constructor.name !== 'undefined' && val.constructor.name.slice(0, 9) === 'Generator') {
      return 'generatorfunction';
    }
    return 'function';
  }

  // array
  if (typeof Array.isArray !== 'undefined' && Array.isArray(val)) {
    return 'array';
  }

  // check for instances of RegExp and Date before calling `toString`
  if (val instanceof RegExp) {
    return 'regexp';
  }
  if (val instanceof Date) {
    return 'date';
  }

  // other objects
  type = toString.call(val);

  if (type === '[object RegExp]') {
    return 'regexp';
  }
  if (type === '[object Date]') {
    return 'date';
  }
  if (type === '[object Arguments]') {
    return 'arguments';
  }
  if (type === '[object Error]') {
    return 'error';
  }
  if (type === '[object Promise]') {
    return 'promise';
  }

  // buffer
  if (isBuffer(val)) {
    return 'buffer';
  }

  // es6: Map, WeakMap, Set, WeakSet
  if (type === '[object Set]') {
    return 'set';
  }
  if (type === '[object WeakSet]') {
    return 'weakset';
  }
  if (type === '[object Map]') {
    return 'map';
  }
  if (type === '[object WeakMap]') {
    return 'weakmap';
  }
  if (type === '[object Symbol]') {
    return 'symbol';
  }
  
  if (type === '[object Map Iterator]') {
    return 'mapiterator';
  }
  if (type === '[object Set Iterator]') {
    return 'setiterator';
  }
  if (type === '[object String Iterator]') {
    return 'stringiterator';
  }
  if (type === '[object Array Iterator]') {
    return 'arrayiterator';
  }
  
  // typed arrays
  if (type === '[object Int8Array]') {
    return 'int8array';
  }
  if (type === '[object Uint8Array]') {
    return 'uint8array';
  }
  if (type === '[object Uint8ClampedArray]') {
    return 'uint8clampedarray';
  }
  if (type === '[object Int16Array]') {
    return 'int16array';
  }
  if (type === '[object Uint16Array]') {
    return 'uint16array';
  }
  if (type === '[object Int32Array]') {
    return 'int32array';
  }
  if (type === '[object Uint32Array]') {
    return 'uint32array';
  }
  if (type === '[object Float32Array]') {
    return 'float32array';
  }
  if (type === '[object Float64Array]') {
    return 'float64array';
  }

  // must be a plain object
  return 'object';
};

/**
 * If you need to support Safari 5-7 (8-10 yr-old browser),
 * take a look at https://github.com/feross/is-buffer
 */

function isBuffer(val) {
  return val.constructor
    && typeof val.constructor.isBuffer === 'function'
    && val.constructor.isBuffer(val);
}


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	!function() {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = function(module) {
/******/ 			var getter = module && module.__esModule ?
/******/ 				function() { return module['default']; } :
/******/ 				function() { return module; };
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	!function() {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = function(exports, definition) {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	!function() {
/******/ 		__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
!function() {
"use strict";
/*!******************************!*\
  !*** ./index.ts + 7 modules ***!
  \******************************/
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "Validator": function() { return /* reexport */ validator.Validator; },
  "default": function() { return /* binding */ index; },
  "filterBuilder": function() { return /* reexport */ filterBuilder; },
  "filterMixin": function() { return /* reexport */ filter_mixin; },
  "optimiseQuery": function() { return /* reexport */ optimisedQuery; },
  "wixDataEncoder": function() { return /* reexport */ wixDataEncoder; }
});

// EXTERNAL MODULE: ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/createClass.js
var createClass = __webpack_require__(523);
var createClass_default = /*#__PURE__*/__webpack_require__.n(createClass);
// EXTERNAL MODULE: ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/inheritsLoose.js
var inheritsLoose = __webpack_require__(333);
var inheritsLoose_default = /*#__PURE__*/__webpack_require__.n(inheritsLoose);
// EXTERNAL MODULE: ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/extends.js
var helpers_extends = __webpack_require__(710);
var extends_default = /*#__PURE__*/__webpack_require__.n(helpers_extends);
// EXTERNAL MODULE: ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/assertThisInitialized.js
var assertThisInitialized = __webpack_require__(50);
var assertThisInitialized_default = /*#__PURE__*/__webpack_require__.n(assertThisInitialized);
// EXTERNAL MODULE: ../../node_modules/@wix/yoshi-webpack-utils/node_modules/@babel/runtime/helpers/defineProperty.js
var defineProperty = __webpack_require__(695);
var defineProperty_default = /*#__PURE__*/__webpack_require__.n(defineProperty);
// EXTERNAL MODULE: ../../node_modules/kind-of/index.js
var kind_of = __webpack_require__(366);
var kind_of_default = /*#__PURE__*/__webpack_require__.n(kind_of);
;// CONCATENATED MODULE: ./type-utils.ts
function isObject(obj){return getKind(obj)==='object';}function isArray(arr){return kind_of_default()(arr)==='array';}function isDate(obj){return kind_of_default()(obj)==='date';}function isNumber(obj){return kind_of_default()(obj)==='number';}function isBoolean(obj){return getKind(obj)==='boolean';}function isString(obj){return kind_of_default()(obj)==='string';}function isFunction(obj){return kind_of_default()(obj)==='function';}function typeForDisplay(obj){return upperCaseFirst(kind_of_default()(obj));}function isUndefined(obj){return getKind(obj)==='undefined';}function isNull(obj){return getKind(obj)==='null';}function upperCaseFirst(str){if(!isString(str)){return str;}var first=str.slice(0,1).toUpperCase();var rest=str.slice(1,str.length);return first+rest;}
;// CONCATENATED MODULE: ./clone.ts
function clone(obj){if(obj==null||typeof obj!=='object'){return obj;}var temp=null;if(isDate(obj)){temp=new Date(obj.getTime());}else{temp=obj.constructor();for(var key in obj){temp[key]=clone(obj[key]);}}return temp;}
;// CONCATENATED MODULE: ./filter-validator.ts
var FilterValidator=/*#__PURE__*/function(){function FilterValidator(operatorName,previousInvalidArguments,ctor){defineProperty_default()(this,"ctor",void 0);defineProperty_default()(this,"_invalidArguments",void 0);defineProperty_default()(this,"_validations",void 0);defineProperty_default()(this,"operatorName",void 0);this._validations=[];this.operatorName=operatorName;this.ctor=ctor;this._invalidArguments=clone(previousInvalidArguments);}var _proto=FilterValidator.prototype;_proto.typeIsString=function typeIsString(value){var _this=this;return this.addValidation(function(){return isString(value);},function(){return"Invalid "+_this.operatorName+" parameter value ["+typeForDisplay(value)+"]. "+_this.operatorName+" parameter must be a String.";});};_proto.typeIsStringNumberOrDate=function typeIsStringNumberOrDate(value){var _this2=this;return this.addValidation(function(){return isDateStringOrNumber(value);},function(){return"Invalid "+_this2.operatorName+" parameter value ["+typeForDisplay(value)+"]. Valid "+_this2.operatorName+" parameter types are String, Number or Date.";});};_proto.sameType=function sameType(first,second){var _this3=this;return this.addValidation(function(){return typeForDisplay(first)===typeForDisplay(second);},function(){return"Invalid "+_this3.operatorName+" parameter values ["+typeForDisplay(first)+"] and ["+typeForDisplay(second)+"]. Both parameters must be of the same type.";});};_proto.typeIsStringNumberOrDateForAll=function typeIsStringNumberOrDateForAll(values){var _this4=this;return this.addValidation(function(){return values.every(isDateStringOrNumber);},function(){return"Invalid "+_this4.operatorName+" usage. "+_this4.operatorName+" supports only Number, String or Date items.";});};_proto.validFieldName=function validFieldName(field){var _this5=this;return this.addValidation(function(){return isString(field);},function(){return"Invalid "+_this5.operatorName+" field value ["+typeForDisplay(field)+"]. "+_this5.operatorName+" field must be a String.";});};_proto.isInstanceOfSameClass=function isInstanceOfSameClass(obj){var _this6=this;return this.addValidation(function(){return obj instanceof _this6.ctor;},function(){return"Invalid "+_this6.operatorName+" parameter ["+typeForDisplay(obj)+"]. "+_this6.operatorName+" expects FilterBuilder only.";});};_proto.arityIsOne=function arityIsOne(args){var _this7=this;return this.addValidation(function(){return args.length===1;},function(){return"Invalid "+_this7.operatorName+" usage. "+_this7.operatorName+" requires one parameter.";});};_proto.arityIsTwo=function arityIsTwo(args){var _this8=this;return this.addValidation(function(){return args.length===2;},function(){return"Invalid "+_this8.operatorName+" usage. "+_this8.operatorName+" requires two parameters.";});};_proto.arityIsThree=function arityIsThree(args){var _this9=this;return this.addValidation(function(){return args.length===3;},function(){return"Invalid "+_this9.operatorName+" usage. "+_this9.operatorName+" requires three parameters.";});};_proto.arityIsAtLeastTwo=function arityIsAtLeastTwo(args){var _this10=this;return this.addValidation(function(){return args.length>=2;},function(){return"Invalid "+_this10.operatorName+" usage. "+_this10.operatorName+" requires at least two parameters.";});};_proto.addValidation=function addValidation(predicateFn,messageFn){this._validations.push({predicateFn:predicateFn,messageFn:messageFn});return this;};_proto.validateAndAggregate=function validateAndAggregate(){var _this11=this;var valid=this._validations.every(function(_ref){var predicateFn=_ref.predicateFn,messageFn=_ref.messageFn;return _this11._appendIfInvalid(predicateFn(),messageFn());});return[this._invalidArguments,valid];};_proto._appendIfInvalid=function _appendIfInvalid(valid,message){if(!valid){this._invalidArguments.push(message);return false;}return true;};return FilterValidator;}();function isDateStringOrNumber(value){return isString(value)||isNumber(value)||isDate(value);}
;// CONCATENATED MODULE: ./query-optimiser.ts
function _createForOfIteratorHelperLoose(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}var optimisations=[optimisedUnaryAnd,optimisedEmptyAnd,optimisedAndsAsObjects,optimisedNestedAnds,optimisedNestedOrs];function optimisedQuery(query){var _fullyOptimised=fullyOptimised(query),newQuery=_fullyOptimised[0];return newQuery;}function fullyOptimised(query){if(Array.isArray(query)){return fullyOptimisedArray(query);}if(typeof query==='object'&&query!==null&&!instanceOfIgnoredType(query)){return fullyOptimisedObject(query);}return[query,false];}function fullyOptimisedArray(query){var optimisedElements=query.map(fullyOptimised);var somethingChanged=0<optimisedElements.filter(function(_ref){var elementChanged=_ref[1];return elementChanged;}).length;var newElements=optimisedElements.map(function(_ref2){var element=_ref2[0];return element;});return[newElements,somethingChanged];}function fullyOptimisedObject(query){var _fullEntriesOptimisat=fullEntriesOptimisation(query),queryAfterOptimisingEntries=_fullEntriesOptimisat[0],changedStage1=_fullEntriesOptimisat[1];var _fullObjectOptimisati=fullObjectOptimisation(queryAfterOptimisingEntries),queryAfterFullOptimisation=_fullObjectOptimisati[0],changedStage2=_fullObjectOptimisati[1];var changed=changedStage1||changedStage2;return[queryAfterFullOptimisation,changed];function fullObjectOptimisation(query){var updatedQuery=applyFirstOptimisation(query);if(!updatedQuery){return[query,false];}var _fullyOptimised2=fullyOptimised(updatedQuery),finalQuery=_fullyOptimised2[0];return[finalQuery,true];}function fullEntriesOptimisation(query){var changedEntries=Object.entries(query).map(entryOptimisation).filter(function(_ref3){var changed=_ref3[2];return changed;});var newQuery=extends_default()({},query,entriesAsObject(changedEntries));var changed=!!changedEntries.length;return[newQuery,changed];}function entryOptimisation(_ref4){var key=_ref4[0],value=_ref4[1];var _fullyOptimised3=fullyOptimised(value),newValue=_fullyOptimised3[0],changed=_fullyOptimised3[1];return[key,newValue,changed];}function entriesAsObject(entries){return entries.reduce(function(acc,_ref5){var _extends2;var key=_ref5[0],value=_ref5[1];return extends_default()({},acc,(_extends2={},_extends2[key]=value,_extends2));},{});}}function applyFirstOptimisation(node){for(var _iterator=_createForOfIteratorHelperLoose(optimisations),_step;!(_step=_iterator()).done;){var optimisation=_step.value;var newNode=optimisation(node);if(newNode){return newNode;}}}function optimisedUnaryAnd(node){var args=node.$and;if(Array.isArray(args)&&args.length===1){return args[0];}}function optimisedEmptyAnd(node){var args=node.$and;if(Array.isArray(args)&&args.length===0){return{};}return null;}function optimisedAndsAsObjects(node){var args=node.$and;if(!args){return;}var basicObjects=[];var operatorObjects=[];args.forEach(function(arg){if(isOperator(arg)){operatorObjects=[].concat(operatorObjects,[arg]);}else{basicObjects=[].concat(basicObjects,[arg]);}});if(basicObjects.length<=1||haveOverlappingFields(basicObjects)){return;}var combinedBasicObjects=Object.assign.apply(Object,[{}].concat(basicObjects));return{$and:[combinedBasicObjects].concat(operatorObjects)};function isOperator(node){var keys=Object.keys(node);return keys.every(function(name){return name.startsWith('$');})&&keys.length>0;}function haveOverlappingFields(objects){var nonUniqueKeys=objects.map(function(it){return Object.keys(it);}).reduce(function(a,b){return[].concat(a,b);},[]);var uniqueKeys=unique(nonUniqueKeys);return uniqueKeys.length!==nonUniqueKeys.length;}function unique(values){var dict={};values.forEach(function(v){return dict[v]=true;});return Object.keys(dict);}}function optimisedNestedAnds(node){var args=node.$and;if(!args){return;}var hasNestedAnds=!!args.find(function(it){return it.$and;});if(!hasNestedAnds){return;}var newArgs=args.reduce(function(result,current){var and=current.$and;if(!and){return[].concat(result,[current]);}return[].concat(result,and);},[]);return{$and:newArgs};}function optimisedNestedOrs(node){var args=node.$or;if(!args){return;}var hasNestedOrs=!!args.find(function(it){return it.$or;});if(!hasNestedOrs){return;}var newArgs=args.reduce(function(result,current){var or=current.$or;if(!or){return[].concat(result,[current]);}return[].concat(result,or);},[]);return{$or:newArgs};}function instanceOfIgnoredType(obj){return obj instanceof Date;}
;// CONCATENATED MODULE: ./filter-mixin.ts
var filterMixin=function filterMixin(Base){if(Base===void 0){Base=function Base(){};}return/*#__PURE__*/function(_Base){inheritsLoose_default()(_class2,_Base);function _class2(obj){var _this;if(obj===void 0){obj={};}_this=_Base.call(this,obj)||this;defineProperty_default()(assertThisInitialized_default()(_this),"filterTree",void 0);defineProperty_default()(assertThisInitialized_default()(_this),"invalidArguments",void 0);defineProperty_default()(assertThisInitialized_default()(_this),"encoder",void 0);_this.filterTree=obj.filterTree||{$and:[]};_this.invalidArguments=obj.invalidArguments||[];_this.encoder=obj.encoder||{};return _this;}var _proto=_class2.prototype;_proto.eq=function eq(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return this._binaryAnd('$eq','.eq',args);};_proto.ne=function ne(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return this._binaryAnd('$ne','.ne',args);};_proto.ge=function ge(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}return this._AndLogicalEquivalence('$gte','.ge',args);};_proto.gt=function gt(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4];}return this._AndLogicalEquivalence('$gt','.gt',args);};_proto.le=function le(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5];}return this._AndLogicalEquivalence('$lte','.le',args);};_proto.lt=function lt(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}return this._AndLogicalEquivalence('$lt','.lt',args);};_proto.isNotEmpty=function isNotEmpty(field){var _this$_filterValidato=this._filterValidator('.isNotEmpty').arityIsOne(arguments).validFieldName(field).validateAndAggregate(),newInvalidArguments=_this$_filterValidato[0],valid=_this$_filterValidato[1];if(valid){return this.ne(field,null);}return this._copy(this.filterTree,newInvalidArguments);};_proto.isEmpty=function isEmpty(field){var _this$_filterValidato2=this._filterValidator('.isEmpty').arityIsOne(arguments).validFieldName(field).validateAndAggregate(),newInvalidArguments=_this$_filterValidato2[0],valid=_this$_filterValidato2[1];if(valid){return this.eq(field,null);}return this._copy(this.filterTree,newInvalidArguments);};_proto.startsWith=function startsWith(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7];}return this._AndStringOperand('$startsWith','.startsWith',args);};_proto.endsWith=function endsWith(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8];}return this._AndStringOperand('$endsWith','.endsWith',args);};_proto.contains=function contains(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++){args[_key9]=arguments[_key9];}return this._AndStringOperand('$contains','.contains',args);};_proto.hasSome=function hasSome(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++){args[_key10]=arguments[_key10];}return this._AndSetOperand('$hasSome','.hasSome',args);};_proto.hasAll=function hasAll(){for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++){args[_key11]=arguments[_key11];}return this._AndSetOperand('$hasAll','.hasAll',args);};_proto.or=function or(orQuery){var _this$_filterValidato3=this._filterValidator('.or').arityIsOne(arguments).isInstanceOfSameClass(orQuery).validateAndAggregate(),newInvalidArguments=_this$_filterValidato3[0],valid=_this$_filterValidato3[1];if(valid){var prefix=isEmptyAnd(this.filterTree)?[]:[this.filterTree];return this._copy(inAnd({$or:[].concat(prefix,[orQuery.filterTree])}),newInvalidArguments.concat(orQuery.invalidArguments));}else{return this._copy(this.filterTree,newInvalidArguments);}};_proto.and=function and(andQuery){var _this$_filterValidato4=this._filterValidator('.and').arityIsOne(arguments).isInstanceOfSameClass(andQuery).validateAndAggregate(),newInvalidArguments=_this$_filterValidato4[0],valid=_this$_filterValidato4[1];if(valid){var prefix=isEmptyAnd(this.filterTree)?[]:[this.filterTree];return this._copy(inAnd.apply(void 0,prefix.concat([andQuery.filterTree])),newInvalidArguments.concat(andQuery.invalidArguments));}else{return this._copy(this.filterTree,newInvalidArguments);}};_proto.not=function not(notQuery){var _this$_filterValidato5=this._filterValidator('.not').arityIsOne(arguments).isInstanceOfSameClass(notQuery).validateAndAggregate(),newInvalidArguments=_this$_filterValidato5[0],valid=_this$_filterValidato5[1];if(valid){var newFilterTree=clone(this.filterTree);var notClause={$not:[notQuery.filterTree]};var resultingFilter=inAndOptimized(newFilterTree,notClause);return this._copy(resultingFilter,newInvalidArguments.concat(notQuery.invalidArguments));}else{return this._copy(this.filterTree,newInvalidArguments);}};_proto.between=function between(field,rangeStart,rangeEnd){var _this$_filterValidato6=this._filterValidator('.between').arityIsThree(arguments).sameType(rangeStart,rangeEnd).typeIsStringNumberOrDate(rangeStart).typeIsStringNumberOrDate(rangeEnd).validateAndAggregate(),newInvalidArguments=_this$_filterValidato6[0],valid=_this$_filterValidato6[1];if(valid){return this.ge(field,rangeStart).lt(field,rangeEnd);}return this._copy(this.filterTree,newInvalidArguments);};_proto.getFilterModel=function getFilterModel(){if(this.invalidArguments.length>0){throw new Error(this.invalidArguments.join(' '));}return optimisedQuery(this.filterTree);};_proto.setFilterModel=function setFilterModel(filterModel){return this._copy(filterModel,[]);};_proto._binaryAnd=function _binaryAnd(filterOperatorSymbol,operatorName,args){var _Array$prototype$slic=Array.prototype.slice.call(args),field=_Array$prototype$slic[0],operand=_Array$prototype$slic[1];var _this$_filterValidato7=this._filterValidator(operatorName).arityIsTwo(args).validFieldName(field).validateAndAggregate(),newInvalidArguments=_this$_filterValidato7[0];var newFilterTree=this._makeNewFilter(field,filterOperatorSymbol,operand);return this._copy(newFilterTree,newInvalidArguments);};_proto._AndLogicalEquivalence=function _AndLogicalEquivalence(filterOperatorSymbol,operatorName,args){var _Array$prototype$slic2=Array.prototype.slice.call(args),field=_Array$prototype$slic2[0],operand=_Array$prototype$slic2[1];var _this$_filterValidato8=this._filterValidator(operatorName).arityIsTwo(args).validFieldName(field).typeIsStringNumberOrDate(operand).validateAndAggregate(),newInvalidArguments=_this$_filterValidato8[0];var newFilterTree=this._makeNewFilter(field,filterOperatorSymbol,operand);return this._copy(newFilterTree,newInvalidArguments);};_proto._AndStringOperand=function _AndStringOperand(filterOperatorName,operatorName,args){var _Array$prototype$slic3=Array.prototype.slice.call(args),field=_Array$prototype$slic3[0],operand=_Array$prototype$slic3[1];var _this$_filterValidato9=this._filterValidator(operatorName).arityIsTwo(args).validFieldName(field).typeIsString(operand).validateAndAggregate(),newInvalidArguments=_this$_filterValidato9[0];var newFilterTree=this._makeNewFilter(field,filterOperatorName,operand);return this._copy(newFilterTree,newInvalidArguments);};_proto._AndSetOperand=function _AndSetOperand(filterOperatorName,operatorName,args){var _Array$prototype$slic4=Array.prototype.slice.call(args),field=_Array$prototype$slic4[0],rawOperands=_Array$prototype$slic4.slice(1);var operands=isArray(rawOperands[0])?rawOperands[0]:rawOperands;var _this$_filterValidato10=this._filterValidator(operatorName).arityIsAtLeastTwo(args).validFieldName(field).typeIsStringNumberOrDateForAll(operands).validateAndAggregate(),newInvalidArguments=_this$_filterValidato10[0];var newFilterTree=this._makeNewFilter(field,filterOperatorName,operands);return this._copy(newFilterTree,newInvalidArguments);};_proto._makeNewFilter=function _makeNewFilter(field,filterOperatorName,operand){var newFilterTree=clone(this.filterTree);// filters with 'undefined' value are lost during serialization,
// e.g. { val: { $ne: undefined } | translates to { val: {} }
// Replacing 'undefined' with 'null' retains the filter.
var serializableOperand=operand===undefined?null:operand;var newFilter=this._buildFilter(field,filterOperatorName,serializableOperand);if(isArray(newFilterTree.$and)){newFilterTree.$and.push(newFilter);return newFilterTree;}else{var result=isEmptyObject(newFilterTree)?inAnd(newFilter):inAnd(newFilterTree,newFilter);return result;}};_proto._buildFilter=function _buildFilter(field,filterOperatorName,operand){if(filterOperatorName!=='$eq'){var newFilter={};newFilter[field]={};newFilter[field][filterOperatorName]=this._encode(operand);return newFilter;}else{var _newFilter={};_newFilter[field]=this._encode(operand);return _newFilter;}};_proto._encode=function _encode(operand){if(isFunction(this.encoder)){return this.encoder(operand);}else{return operand;}};_proto._copy=function _copy(filterTree,invalidArguments){// @ts-ignore-next-line
return new this.constructor(extends_default()({},this,{filterTree:filterTree,invalidArguments:invalidArguments}));};_proto._filterValidator=function _filterValidator(filterOperatorName){return new FilterValidator(filterOperatorName,this.invalidArguments,this.constructor);};return _class2;}(Base);};function isConjunctiveFormFilter(filterTree){return isArray(filterTree.$and);}function isEmptyObject(obj){return Object.keys(obj).length===0;}function inAnd(){for(var _len12=arguments.length,args=new Array(_len12),_key12=0;_key12<_len12;_key12++){args[_key12]=arguments[_key12];}return{$and:args};}function inAndOptimized(){for(var _len13=arguments.length,args=new Array(_len13),_key13=0;_key13<_len13;_key13++){args[_key13]=arguments[_key13];}return{$and:args.reduce(function(aggr,val){return isConjunctiveFormFilter(val)?aggr.concat(val.$and):aggr.concat([val]);},[])};}function isEmptyAnd(node){return node&&node.$and&&node.$and.length===0;}/* harmony default export */ var filter_mixin = (filterMixin);
;// CONCATENATED MODULE: ./filter-builder.ts
var FilterBuilder=/*#__PURE__*/function(_filterMixin){inheritsLoose_default()(FilterBuilder,_filterMixin);function FilterBuilder(){return _filterMixin.apply(this,arguments)||this;}var _proto=FilterBuilder.prototype;_proto._build=function _build(){return this.getFilterModel();};createClass_default()(FilterBuilder,[{key:"constructorName",get:function get(){return'FilterBuilder';}}]);return FilterBuilder;}(filter_mixin());function filterBuilder(params){if(params===void 0){params={};}return new FilterBuilder(params);}/* harmony default export */ var filter_builder = ((/* unused pure expression or super */ null && (filterBuilder)));
// EXTERNAL MODULE: ./validator.ts
var validator = __webpack_require__(347);
;// CONCATENATED MODULE: ./wix-data-encoder.ts
function wixDataEncoder(operand){if(isDate(operand)){return{$date:operand.toJSON()};}else{return operand;}}
;// CONCATENATED MODULE: ./index.ts
/* harmony default export */ var index = (filterBuilder);
}();
/******/ 	return __webpack_exports__;
/******/ })()
;
});
//# sourceMappingURL=filter-builder.umd.js.map