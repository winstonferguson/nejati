"use strict";

exports.__esModule = true;
exports.validationError = exports.validateOmitTransformation = void 0;
var _motionEdmAutogenCommon = require("@wix/motion-edm-autogen-common");
var _lodash = require("lodash");
var _common = require("../common");
const OMIT_SOURCE_PROPERTY_NAME = _common.transformations.OMIT_SOURCE_PROPERTY_NAME,
  FIELDS_TO_OMIT_PROPERTY_NAME = _common.transformations.FIELDS_TO_OMIT_PROPERTY_NAME;
const validationError = (description, value, parentPath = null) => ({
  invalidValue: value,
  description,
  parentPath
});
exports.validationError = validationError;
const validateOmitTransformation = ({
  source,
  fieldsToOmit,
  validateSource,
  parentPath = null
}) => {
  const validationErrors = [];
  const currentPath = parentPath ? [parentPath] : [];
  const omitSourcePropertyPath = [...currentPath, OMIT_SOURCE_PROPERTY_NAME].join('.');
  validationErrors.push(...validateSource(source).validationErrors.map(sourceValidationError => ({
    ...sourceValidationError,
    parentPath: omitSourcePropertyPath
  })));
  const fieldsToOmitPropertyPath = [...currentPath, FIELDS_TO_OMIT_PROPERTY_NAME].join('.');
  if (!(0, _lodash.isArray)(fieldsToOmit) || !(0, _lodash.every)(fieldsToOmit, _lodash.isString)) {
    validationErrors.push(validationError('must be an array of strings', fieldsToOmit, fieldsToOmitPropertyPath));
    return validationErrors;
  }
  if ((0, _lodash.some)(fieldsToOmit, omitPathSegment => (0, _motionEdmAutogenCommon.segmentCount)(omitPathSegment) > 1)) {
    validationErrors.push(validationError('must contain non-nested paths only', fieldsToOmit, fieldsToOmitPropertyPath));
  }
  return validationErrors;
};
exports.validateOmitTransformation = validateOmitTransformation;
//# sourceMappingURL=common.js.map