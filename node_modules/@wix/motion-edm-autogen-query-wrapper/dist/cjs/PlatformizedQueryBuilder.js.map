{"version":3,"names":["_filterBuilder","require","_lodash","_renameFieldByPaths","SortOrder","WIX_DATA_EMPTY_FILTER","$and","toScalaCompatibleFilter","filter","isEqual","PlatformizedQueryBuilder","filterMixin","constructor","obj","transformationPaths","sort","paging","eq","field","value","_transformQueryFieldName","ne","ge","gt","le","lt","isNotEmpty","isEmpty","startsWith","endsWith","contains","hasSome","values","hasAll","between","rangeStart","rangeEnd","in","_AndSetOperand","exists","_binaryAnd","ascending","fieldNames","push","map","fieldName","order","ASC","descending","DESC","skip","offset","limit","build","getFilterModel","renameFieldByPaths","exports"],"sources":["../../src/PlatformizedQueryBuilder.ts"],"sourcesContent":["import { filterMixin } from '@wix/filter-builder';\nimport { isEqual } from 'lodash';\n// import wrapper from './proto-generated';\n\nimport { renameFieldByPaths } from './renameFieldByPaths';\n\n// The use of SortOrder adds @wix/motion-edm-autogen-query-wrapper into the chunk out of auto-fem for certain edms\n// This is a workaround to avoid that\n// const { SortOrder } = wrapper.wix.common;\n\nenum SortOrder {\n  ASC = 0,\n  DESC = 1,\n}\n\nconst WIX_DATA_EMPTY_FILTER = { $and: [] };\n\n// This can be removed when the platformized-filter-builder\n// will stop producing { $and: [] } for an empty filter\nconst toScalaCompatibleFilter = (filter) =>\n  isEqual(filter, WIX_DATA_EMPTY_FILTER) ? {} : filter;\n\nclass PlatformizedQueryBuilder extends filterMixin() {\n  constructor(obj) {\n    super(obj);\n    // We must save transformationPaths on this (without `_` prefix), due to how filterMixin works.\n    // See a more details explanation on PlatformizedQueryMethodWrapper\n    this.transformationPaths = obj.transformationPaths;\n    this.sort = obj.sort || [];\n    this.paging = obj.paging || {};\n  }\n\n  eq(field, value) {\n    return super.eq(this._transformQueryFieldName(field), value);\n  }\n\n  ne(field, value) {\n    return super.ne(this._transformQueryFieldName(field), value);\n  }\n\n  ge(field, value) {\n    return super.ge(this._transformQueryFieldName(field), value);\n  }\n\n  gt(field, value) {\n    return super.gt(this._transformQueryFieldName(field), value);\n  }\n\n  le(field, value) {\n    return super.le(this._transformQueryFieldName(field), value);\n  }\n\n  lt(field, value) {\n    return super.lt(this._transformQueryFieldName(field), value);\n  }\n\n  isNotEmpty(field) {\n    return super.isNotEmpty(this._transformQueryFieldName(field));\n  }\n\n  isEmpty(field) {\n    return super.isEmpty(this._transformQueryFieldName(field));\n  }\n\n  startsWith(field, value) {\n    return super.startsWith(this._transformQueryFieldName(field), value);\n  }\n\n  endsWith(field, value) {\n    return super.endsWith(this._transformQueryFieldName(field), value);\n  }\n\n  contains(field, value) {\n    return super.contains(this._transformQueryFieldName(field), value);\n  }\n\n  hasSome(field, ...values) {\n    return super.hasSome(this._transformQueryFieldName(field), ...values);\n  }\n\n  hasAll(field, ...values) {\n    return super.hasAll(this._transformQueryFieldName(field), ...values);\n  }\n\n  between(field, rangeStart, rangeEnd) {\n    return super.between(\n      this._transformQueryFieldName(field),\n      rangeStart,\n      rangeEnd,\n    );\n  }\n\n  /*\n    TODO: use the custom in() and exists() implementations from super (PlatformizedFilterBuilder) once it is exposed as a class\n    from this module: https://github.com/wix-private/wix-data/blob/master/platformized-filter-builder/src/filterBuilder.es6#L13,\n   */\n\n  in(field, values) {\n    return this._AndSetOperand('$in', '.in', [\n      this._transformQueryFieldName(field),\n      values,\n    ]);\n  }\n\n  exists(field, value) {\n    return this._binaryAnd('$exists', '.exists', [\n      this._transformQueryFieldName(field),\n      value,\n    ]);\n  }\n\n  ascending(...fieldNames) {\n    this.sort.push(\n      ...fieldNames.map((fieldName) => ({\n        fieldName: this._transformQueryFieldName(fieldName),\n        order: SortOrder[SortOrder.ASC],\n      })),\n    );\n\n    return this;\n  }\n\n  descending(...fieldNames) {\n    this.sort.push(\n      ...fieldNames.map((fieldName) => ({\n        fieldName: this._transformQueryFieldName(fieldName),\n        order: SortOrder[SortOrder.DESC],\n      })),\n    );\n\n    return this;\n  }\n\n  skip(offset) {\n    this.paging.offset = offset;\n\n    return this;\n  }\n\n  limit(limit) {\n    this.paging.limit = limit;\n\n    return this;\n  }\n\n  build() {\n    return {\n      filter: toScalaCompatibleFilter(this.getFilterModel()),\n      sort: this.sort,\n      paging: this.paging,\n    };\n  }\n\n  _transformQueryFieldName(field) {\n    return renameFieldByPaths(this.transformationPaths, field);\n  }\n}\n\nexport { PlatformizedQueryBuilder };\n"],"mappings":"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"}