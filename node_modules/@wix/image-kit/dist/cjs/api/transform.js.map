{"version":3,"names":["_imageServiceUtils","require","_browserFeatureSupport","_imageTransformParts","_imageTransformOptions","_imageServiceConstants","getTransform","fittingType","src","target","options","_isSEOBot","isSEOBot","fileType","getFileType","id","fileName","getFileName","name","devicePixelRatio","getDevicePixelRatio","fileExtension","getFileExtension","preferredExtension","canTransformImage","isImageTransformApplicable","hasAnimation","transformsObj","width","height","isCropped","focalPoint","x","y","parts","quality","upscaleMethod","getUpscaleString","progressive","watermark","unsharpMask","filters","transformed","setTransformParts","setTransformOptions","getTarget","targetObj","_isMobile","isMobile","fittingTypes","LEGACY_BG_FIT_AND_TILE","LEGACY_BG_FIT_AND_TILE_HORIZONTAL","LEGACY_BG_FIT_AND_TILE_VERTICAL","LEGACY_BG_NORMAL","maxBGSiteLegacyWidth","MOBILE_MAX_BG_SITE_LEGACY_WIDTH","DSKTP_MAX_BG_SITE_LEGACY_WIDTH","maxBGSiteLegacyHeight","MOBILE_MAX_BG_SITE_LEGACY_HEIGHT","DSKTP_MAX_BG_SITE_LEGACY_HEIGHT","Math","min","round","pixelAspectRatio"],"sources":["../../../src/api/transform.ts"],"sourcesContent":["import {\n  isSEOBot,\n  getFileType,\n  getFileName,\n  getFileExtension,\n  getDevicePixelRatio,\n  getUpscaleString,\n  isImageTransformApplicable,\n} from '../helpers/imageServiceUtils';\nimport { isMobile } from '../helpers/browserFeatureSupport';\nimport { setTransformParts } from '../helpers/imageTransformParts';\nimport { setTransformOptions } from '../helpers/imageTransformOptions';\nimport {\n  MOBILE_MAX_BG_SITE_LEGACY_WIDTH,\n  DSKTP_MAX_BG_SITE_LEGACY_WIDTH,\n  MOBILE_MAX_BG_SITE_LEGACY_HEIGHT,\n  DSKTP_MAX_BG_SITE_LEGACY_HEIGHT,\n  fittingTypes,\n} from '../helpers/imageServiceConstants';\nimport type {\n  FittingType,\n  ImageTransformSource,\n  ImageTransformTarget,\n  ImageTransformOptions,\n  ImageTransformObject,\n} from '../types';\n\n/**\n * returns image transform data\n *\n * @param {FittingType}             fittingType         imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src                 source image\n * @param {ImageTransformTarget}    target              target component\n * @param {ImageTransformOptions}   [options]           transform options\n *\n * @returns {ImageTransformObject}\n */\nfunction getTransform(\n  fittingType: FittingType,\n  src: ImageTransformSource,\n  target: ImageTransformTarget,\n  options?: ImageTransformOptions,\n): ImageTransformObject {\n  const _isSEOBot = isSEOBot(options);\n  const fileType = getFileType(src.id);\n  const fileName = getFileName(src.id, src.name);\n  const devicePixelRatio = _isSEOBot ? 1 : getDevicePixelRatio(target);\n  const fileExtension = getFileExtension(src.id);\n  const preferredExtension = fileExtension;\n  const canTransformImage = isImageTransformApplicable(\n    src.id,\n    options?.hasAnimation,\n  );\n\n  const transformsObj = {\n    fileName,\n    fileExtension,\n    fileType,\n    fittingType,\n    preferredExtension,\n    src: {\n      id: src.id,\n      width: src.width,\n      height: src.height,\n      isCropped: false,\n    },\n    focalPoint: {\n      x: src.focalPoint && src.focalPoint.x,\n      y: src.focalPoint && src.focalPoint.y,\n    },\n    parts: [],\n    // options - general\n    devicePixelRatio,\n    quality: 0,\n    upscaleMethod: getUpscaleString(options),\n    progressive: true,\n    watermark: '',\n    unsharpMask: {},\n    filters: {},\n    transformed: canTransformImage,\n  };\n\n  if (canTransformImage) {\n    setTransformParts(transformsObj, src, target);\n    setTransformOptions(transformsObj, options);\n  }\n\n  return transformsObj;\n}\n\n/**\n * returns target data\n * handle legacy BG site if needed\n *\n * @param {FittingType}             fittingType         imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src                 source image\n * @param {ImageTransformTarget}    target              target component\n *\n * @returns {Object}\n */\nfunction getTarget(\n  fittingType: FittingType,\n  src: ImageTransformSource,\n  target: ImageTransformTarget,\n) {\n  const targetObj = { ...target };\n  const _isMobile = isMobile();\n\n  // handle site BG legacy fitting types (desktop & mobile)\n  switch (fittingType) {\n    case fittingTypes.LEGACY_BG_FIT_AND_TILE:\n    case fittingTypes.LEGACY_BG_FIT_AND_TILE_HORIZONTAL:\n    case fittingTypes.LEGACY_BG_FIT_AND_TILE_VERTICAL:\n    case fittingTypes.LEGACY_BG_NORMAL:\n      const maxBGSiteLegacyWidth = _isMobile\n        ? MOBILE_MAX_BG_SITE_LEGACY_WIDTH\n        : DSKTP_MAX_BG_SITE_LEGACY_WIDTH;\n      const maxBGSiteLegacyHeight = _isMobile\n        ? MOBILE_MAX_BG_SITE_LEGACY_HEIGHT\n        : DSKTP_MAX_BG_SITE_LEGACY_HEIGHT;\n      targetObj.width = Math.min(maxBGSiteLegacyWidth, src.width);\n      targetObj.height = Math.min(\n        maxBGSiteLegacyHeight,\n        Math.round(targetObj.width / (src.width / src.height)),\n      );\n      // for legacy types force htmlTag='bg' and devicePixelRatio=1\n      targetObj.pixelAspectRatio = 1;\n  }\n\n  return targetObj;\n}\n\nexport { getTransform, getTarget };\n"],"mappings":"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"}