{"version":3,"names":["_utils","require","_imageServiceConstants","fitTemplate","template","fillTemplate","fillFocalTemplate","cropTemplate","legacyCropTemplate","legacyFillTemplate","upscaleTemplate","qualityTemplate","unSharpMaskTemplate","nonProgressiveTemplate","watermarkTemplate","filterTemplatesMap","imageFilters","CONTRAST","BRIGHTNESS","SATURATION","HUE","BLUR","autoEncodeTemplate","getImageURI","transformsObj","transformsObjStrArr","parts","forEach","transformPart","transformType","transformTypes","CROP","push","LEGACY_CROP","LEGACY_FILL","legacyFillStr","upscale","FIT","fitStr","FILL","fillStr","FILL_FOCAL","fillFocalStr","transformsStr","join","quality","unsharpMask","progressive","watermark","filters","Object","keys","map","filterName","autoEncode","fileType","GIF","src","id","API_VERSION","fileName","preferredExtension"],"sources":["../../../src/engines/transforms.ts"],"sourcesContent":["import { template } from '../helpers/utils';\nimport {\n  imageFilters,\n  transformTypes,\n  API_VERSION,\n  fileType,\n} from '../helpers/imageServiceConstants';\nimport type { ImageTransformObject, ImageTransformObjectPart } from '../types';\n\n// transform templates\nconst fitTemplate = template`fit/w_${'width'},h_${'height'}`;\nconst fillTemplate = template`fill/w_${'width'},h_${'height'},al_${'alignment'}`;\nconst fillFocalTemplate = template`fill/w_${'width'},h_${'height'},fp_${'focalPointX'}_${'focalPointY'}`;\nconst cropTemplate = template`crop/x_${'x'},y_${'y'},w_${'width'},h_${'height'}`;\n\n// legacy templates\nconst legacyCropTemplate = template`crop/w_${'width'},h_${'height'},al_${'alignment'}`;\nconst legacyFillTemplate = template`fill/w_${'width'},h_${'height'},al_${'alignment'}`;\n\n// upscale template\nconst upscaleTemplate = template`,lg_${'upscaleMethodValue'}`;\n\n// options templates\nconst qualityTemplate = template`,q_${'quality'}`;\nconst unSharpMaskTemplate = template`,usm_${'radius'}_${'amount'}_${'threshold'}`;\nconst nonProgressiveTemplate = template`,bl`;\nconst watermarkTemplate = template`,wm_${'watermark'}`;\nconst filterTemplatesMap = {\n  [imageFilters.CONTRAST]: template`,con_${'contrast'}`,\n  [imageFilters.BRIGHTNESS]: template`,br_${'brightness'}`,\n  [imageFilters.SATURATION]: template`,sat_${'saturation'}`,\n  [imageFilters.HUE]: template`,hue_${'hue'}`,\n  [imageFilters.BLUR]: template`,blur_${'blur'}`,\n};\nconst autoEncodeTemplate = template`,enc_auto`;\n\n/**\n * returns image transform uri\n * @param {object}  transformsObj\n *\n * @returns {string}\n */\nfunction getImageURI(transformsObj: ImageTransformObject): string {\n  // construct image transforms\n  const transformsObjStrArr: string[] = [];\n\n  // construct transform\n  transformsObj.parts.forEach((transformPart: ImageTransformObjectPart) => {\n    switch (transformPart.transformType) {\n      case transformTypes.CROP:\n        transformsObjStrArr.push(cropTemplate(transformPart));\n        break;\n\n      case transformTypes.LEGACY_CROP:\n        transformsObjStrArr.push(legacyCropTemplate(transformPart));\n        break;\n\n      case transformTypes.LEGACY_FILL:\n        let legacyFillStr = legacyFillTemplate(transformPart);\n        if (transformPart.upscale) {\n          legacyFillStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(legacyFillStr);\n        break;\n\n      case transformTypes.FIT:\n        let fitStr = fitTemplate(transformPart);\n        if (transformPart.upscale) {\n          fitStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(fitStr);\n        break;\n\n      case transformTypes.FILL:\n        let fillStr = fillTemplate(transformPart);\n        if (transformPart.upscale) {\n          fillStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(fillStr);\n        break;\n\n      case transformTypes.FILL_FOCAL:\n        let fillFocalStr = fillFocalTemplate(transformPart);\n        if (transformPart.upscale) {\n          fillFocalStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(fillFocalStr);\n        break;\n    }\n  });\n\n  let transformsStr = transformsObjStrArr.join('/');\n\n  // construct transform options\n  // quality\n  if (transformsObj.quality) {\n    transformsStr += qualityTemplate(transformsObj);\n  }\n  // un-sharp mask\n  if (transformsObj.unsharpMask) {\n    transformsStr += unSharpMaskTemplate(transformsObj.unsharpMask);\n  }\n  // progressive\n  if (!transformsObj.progressive) {\n    transformsStr += nonProgressiveTemplate(transformsObj);\n  }\n  // watermark\n  if (transformsObj.watermark) {\n    transformsStr += watermarkTemplate(transformsObj);\n  }\n  // filters\n  if (transformsObj.filters) {\n    transformsStr += Object.keys(transformsObj.filters)\n      .map((filterName) =>\n        filterTemplatesMap[filterName](transformsObj.filters),\n      )\n      .join('');\n  }\n  // auto encode\n  if (transformsObj.autoEncode && transformsObj.fileType !== fileType.GIF) {\n    transformsStr += autoEncodeTemplate(transformsObj);\n  }\n\n  // image url string\n  return `${transformsObj.src.id}/${API_VERSION}/${transformsStr}/${transformsObj.fileName}.${transformsObj.preferredExtension}`;\n}\n\nexport { getImageURI };\n"],"mappings":"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"}